<html>
<head>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script>
 $(document).ready(loadTopics);

 function loadTopics() {
  console.log("Getting top-level topics");
  $.getJSON("/topics/ALL", function(data) {
  	console.log("got data:"+data) 
    $.each(data, function(i, item){
    	$("#browse").append('<br/><input type="button" id="follow_'+item+'" value="'+item+'"/>')
    	$("#follow_"+item).click(subscribe(item));
    });
	})
  }

  function subscribe(topic) {
	if (!!window.EventSource) {
		var source = new EventSource('/topics/'+topic);
		console.log("subscribed to"+topic)
	    source.addEventListener(topic , function(e) {
	      console.log("got message")
	      $("<p>"+e.data + "</p>").insertAfter("#follow_"+topic);
	    }, false);
	} else {
		  console.log("no SSE support!")
		}
  }

  function initTest() {
  	$.post("/topics/one")
  	$.post("/topics/two");
  	$.post("/topics/three")
  }
  </script>
  <meta charset="utf-8" />
</head>
<body>
<h2>Home page</h2>
  <div id="browse">
  <h4>Browse topics</h4> 
  </div>
    <div id="post">
  <h4>Post topics</h4>
  	<input type="button" onclick="initTest()" value="Test"/>
  </div>
</body>
</html>
</html>